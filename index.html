<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Scent Selector</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;}
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --card-bg: #1c1c1e;
            --accent: #0A84FF;
            --accent-hover: #409CFF;
            --border: #38383a;
            --shadow: rgba(0,0,0,0.3);
            --button-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #ffffff;
                --text-color: #000000;
                --card-bg: #f5f5f7;
                --accent: #007AFF;
                --accent-hover: #0051D5;
                --border: #d1d1d6;
                --shadow: rgba(0,0,0,0.1);
                --button-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            padding-bottom: 40px;
            line-height: 1.6;
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            font-size: 40px;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }
        .subtitle {
            text-align: center;
            opacity: 0.6;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        button {
            background: var(--card-bg);
            border: none;
            color: var(--text-color);
            padding: 20px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            -webkit-tap-highlight-color: transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 160px;
            box-shadow: var(--button-shadow);
        }
        button:active {
            transform: scale(0.96);
        }
        button.selected {
            background: var(--accent);
            color: white;
        }
        button.primary {
            background: var(--accent);
            color: white;
            width: 100%;
            margin-top: 10px;
            aspect-ratio: auto;
            min-height: 56px;
            font-size: 18px;
            border-radius: 12px;
        }
        button.primary:active {
            transform: scale(0.98);
        }
        button.secondary {
            background: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border);
            padding: 12px 24px;
            aspect-ratio: auto;
            min-height: auto;
            width: 100%;
            margin-top: 10px;
            border-radius: 12px;
        }
        button.back-button {
            background: transparent;
            box-shadow: none;
            border: none;
            color: var(--accent);
            font-size: 18px;
            padding: 10px;
            margin-bottom: 20px;
            width: auto;
            aspect-ratio: auto;
            min-height: auto;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: flex-start;
        }
        .hidden {
            display: none !important;
        }
        #nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        .nav-btn {
            flex: 1;
            padding: 12px 16px;
            background: var(--card-bg);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            transition: all 0.2s;
            min-height: 44px;
            font-size: 14px;
            color: var(--text-color);
            box-shadow: var(--button-shadow);
        }
        .nav-btn.active {
            background: var(--accent);
            color: white;
        }
        .history-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        .history-actions {
            display: flex;
            gap: 8px;
        }
        .edit-btn, .delete-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s;
            opacity: 0.7;
            color: var(--text-color);
            min-height: 44px;
            min-width: 44px;
        }
        .edit-btn:active, .delete-btn:active {
            transform: scale(0.9);
            opacity: 1;
        }
        .history-context {
            font-size: 13px;
            opacity: 0.6;
            margin-bottom: 8px;
        }
        .history-reasoning {
            font-size: 13px;
            background: rgba(255,255,255,0.05);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 6px 0;
            border-left: 3px solid var(--accent);
        }
        .history-sprays {
            font-size: 13px;
            background: rgba(255,255,255,0.05);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 6px 0;
        }
        .history-date {
            font-size: 12px;
            opacity: 0.5;
            margin-top: 8px;
        }
        .recommendation-card {
            background: var(--card-bg);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }
        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        .recommendation-title {
            font-size: 20px;
            font-weight: 600;
        }
        .recommendation-rating {
            font-size: 24px;
            letter-spacing: 2px;
        }
        .recommendation-reason {
            font-size: 14px;
            background: rgba(255,255,255,0.05);
            padding: 10px 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid var(--accent);
            line-height: 1.5;
        }
        .recommendation-sprays {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent);
            margin-top: 10px;
        }
        .recommendation-spray-location {
            font-size: 13px;
            background: rgba(10,132,255,0.1);
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 8px;
            border-left: 3px solid var(--accent);
        }
        .recommendation-combo {
            font-size: 13px;
            background: rgba(10,132,255,0.08);
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 8px;
            border-left: 3px solid #30B0C0;
            color: #30B0C0;
        }
        .log-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .log-buttons button {
            flex: 1;
            min-height: 44px;
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.6;
        }
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 12px;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: inherit;
            font-size: 16px;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåπ Scent Selector</h1>
        <p class="subtitle">Your AI-Powered Fragrance Guide</p>

        <div id="nav" class="hidden">
            <button class="nav-btn active" onclick="showTab('season', this)">Find Scent</button>
            <button class="nav-btn" onclick="showTab('history', this)">History</button>
            <button class="nav-btn" onclick="showTab('favorites', this)">Favorites</button>
            <button class="nav-btn" onclick="showTab('notes', this)">Notes</button>
        </div>

        <!-- SEASON SCREEN -->
        <div id="seasonScreen">
            <div class="section">
                <h2 class="section-title">Pick Your Season</h2>
                <div class="button-grid">
                    <button onclick="selectSeason('spring')">üå∏<br>Spring</button>
                    <button onclick="selectSeason('summer')">‚òÄÔ∏è<br>Summer</button>
                    <button onclick="selectSeason('fall')">üçÇ<br>Fall</button>
                    <button onclick="selectSeason('winter')">‚ùÑÔ∏è<br>Winter</button>
                </div>
            </div>
        </div>

        <!-- WEATHER SCREEN -->
        <div id="weatherScreen" class="hidden">
            <button class="back-button" onclick="goBack('season')">‚Üê Back</button>
            <div class="section">
                <h2 class="section-title">How's the Weather?</h2>
                <div class="button-grid">
                    <button onclick="selectWeather('cold')">‚ùÑÔ∏è<br>Cold</button>
                    <button onclick="selectWeather('cool')">üå§Ô∏è<br>Cool/Rainy</button>
                    <button onclick="selectWeather('warm')">‚òÄÔ∏è<br>Warm</button>
                    <button onclick="selectWeather('hot')">üî•<br>Hot</button>
                </div>
            </div>
        </div>

        <!-- SITUATION SCREEN -->
        <div id="situationScreen" class="hidden">
            <button class="back-button" onclick="goBack('weather')">‚Üê Back</button>
            <div class="section">
                <h2 class="section-title">What Are You Doing?</h2>
                <div class="button-grid">
                    <button onclick="selectSituation('casual')">üëï<br>Casual Outing</button>
                    <button onclick="selectSituation('work')">üíº<br>Work/Professional</button>
                    <button onclick="selectSituation('date')">üçΩÔ∏è<br>Date Night</button>
                    <button onclick="selectSituation('intimate')">üíë<br>Intimate</button>
                </div>
            </div>
        </div>

        <!-- VIBE SCREEN (only for dates) -->
        <div id="vibeScreen" class="hidden">
            <button class="back-button" onclick="goBack('situation')">‚Üê Back</button>
            <div class="section">
                <h2 class="section-title">What's the Vibe?</h2>
                <div class="button-grid">
                    <button onclick="selectSuspense('building')">üî•<br>Building Suspense</button>
                    <button onclick="selectSuspense('relaxed')">üòå<br>Relaxed</button>
                </div>
            </div>
        </div>

        <!-- RESULTS SCREEN -->
        <div id="resultsScreen" class="hidden">
            <button class="back-button" onclick="goBackToStart()">‚Üê Start Over</button>
            <h2 class="section-title">Your AI Recommendations</h2>
            <div id="recommendations"></div>
            <button class="secondary" onclick="surpriseMe()" style="margin-top:20px;">üé≤ Surprise Me</button>
        </div>

        <!-- HISTORY SCREEN -->
        <div id="historyScreen" class="hidden">
            <h2 class="section-title">Wear History</h2>
            <div id="historyList"></div>
        </div>

        <!-- FAVORITES SCREEN -->
        <div id="favoritesScreen" class="hidden">
            <h2 class="section-title">Favorites</h2>
            <div id="favoritesList"></div>
            <textarea id="favoriteNote" placeholder="Add a note..."></textarea>
            <button class="primary" onclick="saveFavoriteNote()">Save Note</button>
        </div>

        <!-- NOTES SCREEN -->
        <div id="notesScreen" class="hidden">
            <h2 class="section-title">General Notes</h2>
            <textarea id="generalNotes" placeholder="Add your personal fragrance notes here..."></textarea>
            <button class="primary" onclick="saveGeneralNotes()">Save Notes</button>
        </div>
    </div>

    <script>
        const RECOMMENDATIONS = {
          winter: {
            cold: {
              work: [
                {name: "Maison du Soir", rating: 5, reason: "The ultimate winter office scent. Cozy chestnut-vanilla that's professional yet memorable.", sprays: 2, location: "Wrists, neck, and collar (warm pulse points)", combo: "Layer with Cubicle for Men for extra depth"}
              ],
              casual: [
                {name: "Maison du Soir", rating: 5, reason: "Perfect cozy winter errands. The chestnut-cloves-vanilla screams winter comfort without being formal.", sprays: 3, location: "Wrists, neck, and inner elbows", combo: "Stands alone perfectly"}
              ],
              date_relaxed: [
                {name: "Phantom Noir", rating: 5, reason: "THE winter date night king. Coffee-rum-boozy-sweet projects beautifully across tables.", sprays: 3, location: "Chest, neck, wrists, and back of neck", combo: "Don't layer - wear solo for full impact"}
              ],
              date_building: [
                {name: "Phantom Noir", rating: 5, reason: "MAXIMUM SEDUCTION. Dark, rich, mysterious. She'll want you closer all night.", sprays: 3, location: "Chest, wrists, neck (close range points)", combo: "Layer lightly with Brooklyn Jazz on wrists only"}
              ],
              intimate: [
                {name: "Phantom Noir", rating: 5, reason: "THE winter seduction king. Coffee-boozy-sweet is intoxicating at skin-close range.", sprays: 2, location: "Neck, wrists, inner elbows, and chest", combo: "Perfect solo - her nose will stay there"}
              ]
            },
            cool: {
              work: [
                {name: "Maison du Soir", rating: 5, reason: "The ultimate winter office scent. Professional yet memorable.", sprays: 2, location: "Wrists and neck", combo: "Layer with Cubicle for depth"}
              ],
              casual: [
                {name: "Maison du Soir", rating: 5, reason: "Perfect cozy winter errands without being formal.", sprays: 3, location: "Wrists, neck, inner elbows", combo: "Stands alone perfectly"}
              ],
              date_relaxed: [
                {name: "Phantom Noir", rating: 5, reason: "THE winter date night king. Projects beautifully.", sprays: 3, location: "Chest, neck, back of neck", combo: "Don't layer - wear solo"}
              ],
              date_building: [
                {name: "Phantom Noir", rating: 5, reason: "Maximum seduction. She'll want you closer.", sprays: 3, location: "Chest, wrists, neck", combo: "Layer with Brooklyn Jazz on wrists"}
              ],
              intimate: [
                {name: "Phantom Noir", rating: 5, reason: "Intoxicating at skin-close range.", sprays: 2, location: "Neck, wrists, inner elbows, chest", combo: "Perfect solo"}
              ]
            }
          },
          fall: {
            cool: {
              work: [
                {name: "Cubicle for Men", rating: 5, reason: "The office MVP year-round. Fresh-woody character fits autumn perfectly.", sprays: 2, location: "Wrists and neck", combo: "Stands alone great, or layer with Gentle Silver"}
              ],
              casual: [
                {name: "Aventus", rating: 5, reason: "THE perfect fall casual signature. Fruity-smoky shines in autumn air.", sprays: 2, location: "Chest, wrists, upper back", combo: "Layer with Gentle Silver on wrists"}
              ],
              date_relaxed: [
                {name: "Vanille Absolute", rating: 5, reason: "THE fall date night king. Autumn romance perfected. Universally loved.", sprays: 3, location: "Chest, neck, wrists, back of neck", combo: "Don't layer - wear solo for full effect"}
              ],
              date_building: [
                {name: "Vanille Absolute", rating: 5, reason: "Fall seduction with spicy-sweet warmth. Unforgettable chemistry.", sprays: 3, location: "Chest, neck, wrists (close points)", combo: "Layer lightly with Brooklyn Jazz on wrists"}
              ],
              intimate: [
                {name: "Vanille Absolute", rating: 5, reason: "Fall seduction KING. Spicy-sweet at skin-close is intoxicating.", sprays: 2, location: "Neck, wrists, inner elbows, behind ears", combo: "Perfect solo - she'll want to stay close"}
              ]
            },
            warm: {
              work: [
                {name: "Cubicle for Men", rating: 5, reason: "Office champion in warmer fall weather.", sprays: 2, location: "Wrists and neck", combo: "Stands alone or layer with Gentle Silver"}
              ],
              casual: [
                {name: "Aventus", rating: 5, reason: "Perfect fall casual in warmer weather.", sprays: 2, location: "Chest, wrists, upper back", combo: "Layer with Gentle Silver on wrists"}
              ],
              date_relaxed: [
                {name: "Vanille Absolute", rating: 5, reason: "Fall date king remains perfect in warmth.", sprays: 2, location: "Chest, neck, wrists", combo: "Don't layer - wear solo"}
              ],
              date_building: [
                {name: "Vanille Absolute", rating: 5, reason: "Seduction perfected in warm fall weather.", sprays: 2, location: "Chest, neck, wrists", combo: "Layer with Brooklyn Jazz on wrists"}
              ],
              intimate: [
                {name: "Vanille Absolute", rating: 5, reason: "Intoxicating at close range.", sprays: 2, location: "Neck, wrists, inner elbows, behind ears", combo: "Perfect solo"}
              ]
            }
          },
          spring: {
            cold: {
              work: [
                {name: "Cubicle for Men", rating: 5, reason: "Office year-round champion. Fresh-woody fits warming weather.", sprays: 2, location: "Wrists and neck", combo: "Layer with Gentle Silver for depth"}
              ],
              casual: [
                {name: "Victory Man", rating: 5, reason: "Perfect spring fresh for everyday wear. Light and season-perfect.", sprays: 2, location: "Wrists, chest, neck", combo: "Stands alone perfectly"}
              ],
              date_relaxed: [
                {name: "Aventus", rating: 5, reason: "THE spring date classic. Fruity-fresh perfection.", sprays: 2, location: "Chest, neck, wrists", combo: "Don't layer - wear solo for charm"}
              ],
              date_building: [
                {name: "Aventus", rating: 4, reason: "Fresh confidence for spring seduction.", sprays: 2, location: "Chest, wrists, neck", combo: "Layer with Gentle Silver on wrists"}
              ],
              intimate: [
                {name: "Aventus", rating: 5, reason: "Spring intimate champion. Clean-sexy-fresh at close range.", sprays: 2, location: "Neck, wrists, inner elbows, chest", combo: "Perfect solo"}
              ]
            },
            warm: {
              work: [
                {name: "Victory Man", rating: 5, reason: "Perfect spring fresh for office in warmth.", sprays: 2, location: "Wrists and neck", combo: "Stands alone"}
              ],
              casual: [
                {name: "Victory Man", rating: 5, reason: "Perfect spring fresh casual in warmth.", sprays: 2, location: "Wrists, chest, neck", combo: "Stands alone"}
              ],
              date_relaxed: [
                {name: "Aventus", rating: 5, reason: "Spring date classic in warm weather.", sprays: 2, location: "Chest, neck, wrists", combo: "Don't layer - wear solo"}
              ],
              date_building: [
                {name: "Aventus", rating: 4, reason: "Fresh spring seduction in warmth.", sprays: 2, location: "Chest, wrists, neck", combo: "Layer with Gentle Silver"}
              ],
              intimate: [
                {name: "Aventus", rating: 5, reason: "Spring intimate in warmth.", sprays: 2, location: "Neck, wrists, inner elbows, chest", combo: "Perfect solo"}
              ]
            }
          },
          summer: {
            cold: {
              work: [
                {name: "Cubicle for Men", rating: 5, reason: "Office champion in summer AC spaces.", sprays: 2, location: "Wrists and neck", combo: "Layer with Victory Man"}
              ],
              casual: [
                {name: "Victory Man", rating: 5, reason: "Ultimate summer fresh casual. Light and perfect.", sprays: 2, location: "Wrists, chest, neck", combo: "Stands alone perfectly"}
              ],
              date_relaxed: [
                {name: "Aventus", rating: 5, reason: "Summer date king with restraint.", sprays: 2, location: "Chest, neck, wrists", combo: "Don't layer - wear solo"}
              ],
              date_building: [
                {name: "Aventus", rating: 4, reason: "Summer heat + fresh confidence = magnetic.", sprays: 2, location: "Chest, wrists, neck", combo: "Layer with Gentle Silver"}
              ],
              intimate: [
                {name: "Aventus", rating: 5, reason: "Summer intimate champion. Clean-sexy at close range.", sprays: 2, location: "Neck, wrists, inner elbows, chest", combo: "Perfect solo"}
              ]
            },
            warm: {
              work: [
                {name: "Victory Man", rating: 5, reason: "Perfect summer fresh for office in warmth.", sprays: 2, location: "Wrists and neck", combo: "Stands alone"}
              ],
              casual: [
                {name: "Victory Man", rating: 5, reason: "Ultimate summer casual in warmth.", sprays: 2, location: "Wrists, chest, neck", combo: "Stands alone"}
              ],
              date_relaxed: [
                {name: "Aventus", rating: 5, reason: "Summer date in warm weather.", sprays: 2, location: "Chest, neck, wrists", combo: "Don't layer - wear solo"}
              ],
              date_building: [
                {name: "Aventus", rating: 4, reason: "Summer seduction in warmth.", sprays: 2, location: "Chest, wrists, neck", combo: "Layer with Gentle Silver"}
              ],
              intimate: [
                {name: "Aventus", rating: 5, reason: "Summer intimate in warmth.", sprays: 2, location: "Neck, wrists, inner elbows, chest", combo: "Perfect solo"}
              ]
            }
          }
        };

        let currentSeason = '', currentWeather = '', currentSituation = '', currentSuspense = null;
        let wearHistory = JSON.parse(localStorage.getItem('wearHistory')||'[]');
        let favorites = JSON.parse(localStorage.getItem('favorites')||'[]');
        let generalNotes = localStorage.getItem('generalNotes')||'';

        function init(){loadHistory();loadFavorites();loadGeneralNotes();}
        function showTab(tab,el){document.querySelectorAll('[id$="Screen"]').forEach(s=>s.classList.add('hidden'));document.getElementById(tab+'Screen').classList.remove('hidden');document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));if(el)el.classList.add('active');}
        function selectSeason(season){currentSeason=season;document.getElementById('seasonScreen').classList.add('hidden');document.getElementById('weatherScreen').classList.remove('hidden');}
        function selectWeather(weather){currentWeather=weather;document.getElementById('weatherScreen').classList.add('hidden');document.getElementById('situationScreen').classList.remove('hidden');}
        function selectSituation(situation){currentSituation=situation;if(situation==='date'){document.getElementById('situationScreen').classList.add('hidden');document.getElementById('vibeScreen').classList.remove('hidden');}else{currentSuspense='relaxed';showRecommendations();}}
        function selectSuspense(suspense){currentSuspense=suspense;showRecommendations();}
        function goBack(to){if(to==='season'){currentSeason='';currentWeather='';currentSituation='';currentSuspense=null;document.getElementById('weatherScreen').classList.add('hidden');document.getElementById('situationScreen').classList.add('hidden');document.getElementById('vibeScreen').classList.add('hidden');document.getElementById('resultsScreen').classList.add('hidden');document.getElementById('seasonScreen').classList.remove('hidden');}else if(to==='weather'){currentWeather='';currentSituation='';currentSuspense=null;document.getElementById('situationScreen').classList.add('hidden');document.getElementById('vibeScreen').classList.add('hidden');document.getElementById('resultsScreen').classList.add('hidden');document.getElementById('weatherScreen').classList.remove('hidden');}else if(to==='situation'){currentSituation='';currentSuspense=null;document.getElementById('vibeScreen').classList.add('hidden');document.getElementById('resultsScreen').classList.add('hidden');document.getElementById('situationScreen').classList.remove('hidden');}}
        function showRecommendations(){document.getElementById('vibeScreen').classList.add('hidden');document.getElementById('situationScreen').classList.add('hidden');document.getElementById('weatherScreen').classList.add('hidden');document.getElementById('seasonScreen').classList.add('hidden');document.getElementById('resultsScreen').classList.remove('hidden');renderRecommendations();}
        function renderRecommendations(){let lookupKey=currentSituation;if(currentSituation==='date'){lookupKey='date_'+currentSuspense;}const recs=RECOMMENDATIONS[currentSeason]?.[currentWeather]?.[lookupKey]||[];const recsDiv=document.getElementById('recommendations');recsDiv.innerHTML='';if(recs.length===0){recsDiv.innerHTML='<div class="empty-state">No recommendations available for this combination</div>';return;}recs.forEach((rec,idx)=>{const stars='‚≠ê'.repeat(rec.rating)+('‚òÜ'.repeat(5-rec.rating));const card=document.createElement('div');card.className='recommendation-card';card.innerHTML=`<div class="recommendation-header"><div class="recommendation-title">${rec.name}</div><div class="recommendation-rating">${stars}</div></div><div class="recommendation-reason"><strong>Why:</strong> ${rec.reason}</div><div class="recommendation-sprays">üí® ${rec.sprays} Sprays</div><div class="recommendation-spray-location">üìç ${rec.location}</div><div class="recommendation-combo">‚ú® ${rec.combo}</div><div class="log-buttons"><button class="primary" onclick="logFragrance('${rec.name}',${rec.rating},'${rec.reason.replace(/'/g,"\\'")}',${rec.sprays},'${rec.location.replace(/'/g,"\\'")}')">Log This</button></div>`;recsDiv.appendChild(card);});}
        function logFragrance(name,rating,reason,sprays,location){const entry={type:'single',fragrance:name,season:currentSeason,weather:currentWeather,situation:currentSituation,date:new Date().toISOString(),rating,reason,sprays,location};wearHistory.unshift(entry);if(wearHistory.length>50)wearHistory=wearHistory.slice(0,50);localStorage.setItem('wearHistory',JSON.stringify(wearHistory));alert(`‚úÖ Logged: ${name}`);loadHistory();goBackToStart();}
        function goBackToStart(){currentSeason='';currentWeather='';currentSituation='';currentSuspense=null;document.querySelectorAll('[id$="Screen"]').forEach(s=>s.classList.add('hidden'));document.getElementById('seasonScreen').classList.remove('hidden');document.getElementById('nav').classList.remove('hidden');}
        function loadHistory(){const list=document.getElementById('historyList');if(wearHistory.length===0){list.innerHTML='<div class="empty-state">No wears logged yet</div>';return;}list.innerHTML='';wearHistory.forEach((h,idx)=>{const item=document.createElement('div');item.className='history-item';const fragName=h.fragrance||'Unknown';const ratingStars='‚≠ê'.repeat(h.rating||0);const ratingText=h.rating?`${ratingStars} (${h.rating}/5)`:'Not rated';const reasoningText=h.reason?`<div class="history-reasoning"><strong>Why:</strong> ${h.reason}</div>`:'';const sprayText=h.sprays?`<div class="history-sprays"><strong>üí® Sprays:</strong> ${h.sprays}</div>`:'';const locationText=h.location?`<div class="history-sprays"><strong>üìç Spray Location:</strong> ${h.location}</div>`:'';item.innerHTML=`<div class="history-header"><strong>${fragName}</strong><div class="history-actions"><button class="edit-btn" onclick="editHistoryReason(${idx})" title="Edit">‚úèÔ∏è</button><button class="delete-btn" onclick="deleteHistoryItem(${idx})" title="Delete">üóëÔ∏è</button></div></div><div class="history-context">${h.season} ‚Ä¢ ${h.situation}</div><div style="font-size:14px;font-weight:600;color:var(--accent);margin-bottom:6px;">${ratingText}</div>${reasoningText}${sprayText}${locationText}<div class="history-date">${new Date(h.date).toLocaleDateString()}</div>`;list.appendChild(item);});}
        function editHistoryReason(idx){const h=wearHistory[idx];if(!h)return;const newReason=prompt('Edit reasoning for '+h.fragrance,h.reason||'');if(newReason!==null){wearHistory[idx].reason=newReason;localStorage.setItem('wearHistory',JSON.stringify(wearHistory));loadHistory();}}
        function deleteHistoryItem(idx){const h=wearHistory[idx];if(!h)return;if(confirm('Delete this wear log entry for '+h.fragrance+'?')){wearHistory.splice(idx,1);localStorage.setItem('wearHistory',JSON.stringify(wearHistory));loadHistory();}}
        function loadFavorites(){const list=document.getElementById('favoritesList');if(favorites.length===0){list.innerHTML='<div class="empty-state">No favorites yet</div>';return;}list.innerHTML='';favorites.forEach((fav,idx)=>{const item=document.createElement('div');item.className='history-item';item.innerHTML=`<strong>${fav}</strong><button class="secondary" onclick="deleteFavorite(${idx})" style="margin-top:10px;width:100%;min-height:44px;">Remove</button>`;list.appendChild(item);});}
        function deleteFavorite(idx){favorites.splice(idx,1);localStorage.setItem('favorites',JSON.stringify(favorites));loadFavorites();}
        function loadGeneralNotes(){document.getElementById('generalNotes').value=generalNotes;}
        function saveGeneralNotes(){generalNotes=document.getElementById('generalNotes').value;localStorage.setItem('generalNotes',generalNotes);alert('Notes saved!');}
        function surpriseMe(){const allRecs=Object.values(RECOMMENDATIONS).flatMap(s=>Object.values(s)).flatMap(w=>Object.values(w)).flatMap(situ=>Array.isArray(situ)?situ:Object.values(situ)).flat();if(allRecs.length===0)return;const pick=allRecs[Math.floor(Math.random()*allRecs.length)];alert(`Try: ${pick.name}`);}

        window.addEventListener('DOMContentLoaded',()=>{init();document.getElementById('nav').classList.remove('hidden');});
    </script>
</body>
</html>
